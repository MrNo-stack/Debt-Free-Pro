<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DebtFree App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .tab-active { color: #2563eb; border-top: 2px solid #2563eb; }
        canvas { max-width: 100% !important; }
        .view { transition: opacity 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

    <!-- Desktop Header -->
    <header class="hidden md:flex glass sticky top-0 z-50 px-8 py-4 border-b items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="bg-blue-600 text-white p-1.5 rounded-lg font-black text-xl">DF</div>
            <h1 class="text-xl font-extrabold tracking-tight">DebtFree</h1>
        </div>
        <div id="status-indicator" class="text-[10px] font-bold text-slate-400 bg-slate-100 px-3 py-1 rounded-full uppercase tracking-wider">Local Mode</div>
    </header>

    <!-- Mobile Header -->
    <header class="md:hidden flex px-6 py-4 items-center justify-between border-b glass sticky top-0 z-50">
        <h1 class="font-extrabold text-lg">DebtFree</h1>
        <div id="mobile-surplus" class="text-emerald-600 font-black">$0</div>
    </header>

    <main id="main-content" class="flex-1 pb-24 md:pb-8">
        <!-- Dashboard View -->
        <div id="view-dashboard" class="view p-4 md:p-8 max-w-7xl mx-auto space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Overview Cards -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Monthly Surplus</p>
                    <h2 id="stat-surplus" class="text-3xl font-black text-emerald-600">$0</h2>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Total Debt</p>
                    <h2 id="stat-debt" class="text-3xl font-black text-slate-800">$0</h2>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Debt Free Date</p>
                    <h2 id="stat-date" class="text-3xl font-black text-blue-600">--</h2>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                <div class="bg-slate-900 p-6 rounded-2xl shadow-xl min-h-[400px]">
                    <h3 class="text-white font-bold mb-4">Payoff Projection</h3>
                    <div class="h-64 md:h-80"><canvas id="debtChart"></canvas></div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 min-h-[400px]">
                    <h3 class="text-slate-800 font-bold mb-4">Net Worth Forecast</h3>
                    <div class="h-64 md:h-80"><canvas id="nwChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Inputs View -->
        <div id="view-inputs" class="view hidden p-4 md:p-8 max-w-4xl mx-auto space-y-8">
            <section class="space-y-4">
                <h3 class="text-xl font-bold">Income & Budget</h3>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] font-bold uppercase text-slate-500">Monthly Income</label>
                            <input type="number" id="input-income" class="w-full text-xl font-bold p-3 bg-slate-50 rounded-xl mt-1 border focus:border-blue-500 outline-none" value="5000" oninput="saveData()">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase text-slate-500">Fixed Expenses</label>
                            <input type="number" id="input-expenses" class="w-full text-xl font-bold p-3 bg-slate-50 rounded-xl mt-1 border focus:border-blue-500 outline-none" value="2500" oninput="saveData()">
                        </div>
                    </div>
                </div>
            </section>

            <section class="space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Debts</h3>
                    <button onclick="addDebt()" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold active:scale-95 transition-transform">+ Add Debt</button>
                </div>
                <div id="debt-list" class="space-y-3"></div>
            </section>
        </div>
    </main>

    <!-- Mobile Navigation -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 glass border-t flex justify-around items-center safe-bottom h-20 z-50">
        <button onclick="switchView('dashboard')" id="tab-dashboard" class="flex flex-col items-center gap-1 text-slate-400 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
            <span class="text-[10px] font-bold">Overview</span>
        </button>
        <button onclick="switchView('inputs')" id="tab-inputs" class="flex flex-col items-center gap-1 text-slate-400 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
            <span class="text-[10px] font-bold">Edit Data</span>
        </button>
    </nav>

    <script>
        // State Management
        let state = {
            income: 5000,
            expenses: 2500,
            debts: [
                { id: 1, name: 'Credit Card', balance: 5000, apr: 22, min: 150 },
                { id: 2, name: 'Car Loan', balance: 15000, apr: 6, min: 350 }
            ]
        };

        let charts = {};

        // Storage Logic
        function loadData() {
            const saved = localStorage.getItem('debtfree_data');
            if (saved) {
                state = JSON.parse(saved);
            }
            syncUIFromState();
            calculate();
        }

        window.saveData = () => {
            state.income = parseFloat(document.getElementById('input-income').value) || 0;
            state.expenses = parseFloat(document.getElementById('input-expenses').value) || 0;
            localStorage.setItem('debtfree_data', JSON.stringify(state));
            calculate();
        };

        // Navigation
        window.switchView = (view) => {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');
            
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${view}`).classList.add('tab-active');
            
            if (view === 'dashboard') calculate();
        };

        // UI Manipulation
        function syncUIFromState() {
            document.getElementById('input-income').value = state.income;
            document.getElementById('input-expenses').value = state.expenses;
            renderDebtList();
        }

        function renderDebtList() {
            const list = document.getElementById('debt-list');
            list.innerHTML = state.debts.map((d, i) => `
                <div class="bg-white p-4 rounded-xl border flex flex-col gap-3 shadow-sm hover:border-blue-200 transition-colors">
                    <div class="flex justify-between items-center">
                        <input type="text" value="${d.name}" class="font-bold outline-none border-b border-transparent focus:border-blue-400 w-2/3" onchange="updateDebt(${i}, 'name', this.value)">
                        <button onclick="removeDebt(${i})" class="text-rose-500 text-[10px] font-black uppercase tracking-tighter">Remove</button>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-slate-400 uppercase">Balance</label>
                            <div class="relative">
                                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">$</span>
                                <input type="number" value="${d.balance}" class="w-full text-xs font-bold pl-5 p-2 bg-slate-50 rounded-lg border focus:ring-1 focus:ring-blue-500 outline-none" oninput="updateDebt(${i}, 'balance', this.value)">
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-slate-400 uppercase">APR %</label>
                            <input type="number" value="${d.apr}" class="w-full text-xs font-bold p-2 bg-slate-50 rounded-lg border focus:ring-1 focus:ring-blue-500 outline-none" oninput="updateDebt(${i}, 'apr', this.value)">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-slate-400 uppercase">Min Pmt</label>
                            <div class="relative">
                                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400 text-xs">$</span>
                                <input type="number" value="${d.min}" class="w-full text-xs font-bold pl-5 p-2 bg-slate-50 rounded-lg border focus:ring-1 focus:ring-blue-500 outline-none" oninput="updateDebt(${i}, 'min', this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.updateDebt = (idx, field, val) => {
            state.debts[idx][field] = field === 'name' ? val : parseFloat(val);
            localStorage.setItem('debtfree_data', JSON.stringify(state));
            calculate();
        };

        window.addDebt = () => {
            state.debts.push({ id: Date.now(), name: 'New Debt', balance: 1000, apr: 15, min: 25 });
            renderDebtList();
            saveData();
        };

        window.removeDebt = (idx) => {
            state.debts.splice(idx, 1);
            renderDebtList();
            saveData();
        };

        // Financial Simulation
        function calculate() {
            const debtsArr = state.debts || [];
            const totalMin = debtsArr.reduce((s,d) => s + (d.min || 0), 0);
            const surplus = state.income - state.expenses - totalMin;
            
            document.getElementById('stat-surplus').innerText = `$${Math.max(0, Math.round(surplus)).toLocaleString()}`;
            document.getElementById('mobile-surplus').innerText = `$${Math.max(0, Math.round(surplus)).toLocaleString()}`;
            document.getElementById('stat-debt').innerText = `$${Math.round(debtsArr.reduce((s,d) => s + (d.balance || 0), 0)).toLocaleString()}`;

            // Simulation (Avalanche)
            let simDebts = JSON.parse(JSON.stringify(debtsArr)).sort((a,b) => b.apr - a.apr);
            let history = [{ month: 0, balance: simDebts.reduce((s,d) => s + d.balance, 0) }];
            let months = 0;

            while (months < 240) {
                months++;
                let currentCash = state.income - state.expenses;
                
                // 1. Accrue Interest
                simDebts.forEach(d => { if (d.balance > 0) d.balance *= (1 + (d.apr/100)/12); });

                // 2. Pay Minimums
                simDebts.forEach(d => {
                    if (d.balance > 0) {
                        let p = Math.min(d.balance, d.min);
                        d.balance -= p;
                        currentCash -= p;
                    }
                });

                // 3. Apply Surplus to High Interest
                for (let d of simDebts) {
                    if (d.balance > 0) {
                        let p = Math.min(d.balance, Math.max(0, currentCash));
                        d.balance -= p;
                        currentCash -= p;
                        if (currentCash <= 0) break;
                    }
                }

                let total = simDebts.reduce((s,d) => s + Math.max(0, d.balance), 0);
                history.push({ month: months, balance: total });
                if (total <= 0) break;
            }

            document.getElementById('stat-date').innerText = months >= 240 ? "20+ Years" : `${months} Months`;
            renderCharts(history);
        }

        function renderCharts(history) {
            // Debt Chart
            const ctxD = document.getElementById('debtChart').getContext('2d');
            if (charts.debt) charts.debt.destroy();
            charts.debt = new Chart(ctxD, {
                type: 'line',
                data: {
                    labels: history.map(h => h.month),
                    datasets: [{
                        label: 'Debt',
                        data: history.map(h => h.balance),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#64748b', maxTicksLimit: 10 } },
                        y: { grid: { color: '#334155' }, ticks: { color: '#64748b' } }
                    }
                }
            });

            // Net Worth Chart
            const ctxNW = document.getElementById('nwChart').getContext('2d');
            if (charts.nw) charts.nw.destroy();
            charts.nw = new Chart(ctxNW, {
                type: 'line',
                data: {
                    labels: history.map(h => h.month),
                    datasets: [{
                        label: 'NW',
                        data: history.map(h => (h.month * 500) - h.balance),
                        borderColor: '#10b981',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { maxTicksLimit: 10 } },
                        y: { grid: { color: '#f1f5f9' } }
                    }
                }
            });
        }

        window.onload = () => {
            loadData();
            switchView('dashboard');
        };
    </script>
</body>
</html>
